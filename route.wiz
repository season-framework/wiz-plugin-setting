{"route":"import datetime\n\nmenus = []\nmenus.append({\"url\": \"/wiz/admin/setting/status\", \"icon\": \"fas fa-heartbeat\", \"title\": \"System Status\", 'pattern': r'^/wiz/admin/setting/status'})\nmenus.append({\"url\": \"/wiz/admin/setting/configuration\", \"icon\": \"fas fa-cog\", \"title\": \"Configuration\", 'pattern': r'^/wiz/admin/setting/configuration'})\nmenus.append({\"url\": \"/wiz/admin/setting/plugin/list\", \"icon\": \"fas fa-plug\", \"title\": \"Plugin\", 'pattern': r'^/wiz/admin/setting/plugin/list'})\nmenus.append({\"url\": \"/wiz/admin/setting/acl\", \"icon\": \"fas fa-shield-alt\", \"title\": \"Access control\", 'pattern': r'^/wiz/admin/setting/acl'})\nmenus.append({\"url\": \"/wiz/admin/setting/onerror\", \"icon\": \"fas fa-exclamation-triangle\", \"title\": \"On error\", 'pattern': r'^/wiz/admin/setting/onerror'})\nmenus.append({\"url\": \"/wiz/admin/setting/onboot\", \"icon\": \"fas fa-power-off\", \"title\": \"On boot\", 'pattern': r'^/wiz/admin/setting/onboot'})\nmenus.append({\"url\": \"/wiz/admin/setting/build_resource\", \"icon\": \"fas fa-filter\", \"title\": \"Build resource\", 'pattern': r'^/wiz/admin/setting/build_resource'})\nmenus.append({\"url\": \"/wiz/admin/setting/after_request\", \"icon\": \"fas fa-filter\", \"title\": \"After Request\", 'pattern': r'^/wiz/admin/setting/after_request'})\n\ndef setting_nav(menus):\n    def itermenu(menu):\n        pt = None\n        if 'pattern' in menu: pt = menu['pattern']\n        elif 'url' in menu: pt = menu['url']\n        if pt is not None:\n            if framework.request.match(pt): menu['class'] = 'active'\n            else: menu['class'] = ''\n        \n    for menu in menus:\n        itermenu(menu)\n    return menus\n\nmenus = setting_nav(menus)\n\nframework.layout('core.theme.layout', navbar=True, monaco=True)\nframework.render(\"status\", \"core.setting.status\", settingmenus=menus)\nframework.render(\"configuration\", \"core.setting.configuration\", settingmenus=menus)\nframework.render(\"plugin/list\", \"core.setting.plugin.list\", settingmenus=menus)\nframework.render(\"acl\", \"core.setting.acl\", settingmenus=menus)\nframework.render(\"onerror\", \"core.setting.onerror\", settingmenus=menus)\nframework.render(\"onboot\", \"core.setting.onboot\", settingmenus=menus)\nframework.render(\"build_resource\", \"core.setting.build_resource\", settingmenus=menus)\nframework.render(\"after_request\", \"core.setting.after_request\", settingmenus=menus)\n\nframework.layout('core.theme.layout', navbar=False, monaco=True)\nframework.render(\"plugin/editor/<plugin_id>\", \"core.setting.plugin.editor\")\nframework.render(\"plugin/browser/<plugin_id>/<target>\", \"core.setting.plugin.browser\")\n\nsegment = framework.match(\"plugin/preview/<plugin_id>/<bundle_id>\")\nif segment is not None:\n    plugin_id = segment.plugin_id\n    bundle_id = segment.bundle_id\n    framework.request.segment = season.stdClass()\n    plugin = framework.model(\"plugin\").instance(plugin_id)\n    plugin.layout('core.theme.layout', navbar=False, monaco=True)\n    plugin.render(bundle_id, settingmenus=menus)\n\n\nsegment = framework.match(\"api/config/clean\")\nif segment is not None:\n    fs = framework.model(\"wizfs\").use(\"wiz\")\n    fs.delete(\"public/templates\")\n    fs.delete(\"cache\")\n    fs.write(\"config/.cache\", datetime.datetime.now().strftime(\"%Y-%m-%d %H:%M:%S\"))\n    framework.response.status(200, True)\n\nframework.response.redirect(\"status\")","builder":""}